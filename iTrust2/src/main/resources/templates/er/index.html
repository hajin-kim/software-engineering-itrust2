<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head th:include="layout :: head(title=~{::title}, links=~{})">-->
<!--	<title>Emergency Responder Home</title>-->
<!--	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">-->
<!--	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>-->
<!--	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
<!--</head>-->
<!--<body th:include="layout :: body" th:with="content=~{::content}">-->
<!--<div th:fragment="content">-->
<!--	<script th:inline="javascript">-->
<!--		var app = angular.module('emergencyResponderApp', []);-->

<!--		app.controller('emergencyResponderController', function ($scope, $http) {-->
<!--			$scope.searchTerm = '';-->
<!--			$scope.patients = [];-->
<!--			$scope.message = 'Welcome';-->
<!--			$scope.showPatientDetails = false;-->

<!--			$scope.calculateAge = function (birthDate) {-->
<!--				// Assuming birthDate is in the format 'yyyy-MM-dd'-->
<!--				var birthYear = new Date(birthDate).getFullYear();-->
<!--				var currentYear = new Date().getFullYear();-->
<!--				return currentYear - birthYear;-->
<!--			};-->

<!--			$scope.search = function () {-->
<!--				if (!$scope.searchTerm.trim()) {-->
<!--					$scope.message = 'No data found. Please enter a search term.';-->
<!--					$scope.patients = [];-->
<!--				} else {-->
<!--					$http.get('/iTrust2/api/v1/patientSearch', { params: { nameQuery: $scope.searchTerm } })-->
<!--							.then(function (response) {-->
<!--								$scope.patients = response.data;-->
<!--								$scope.patients = filterPatients(response.data, $scope.searchTerm);-->
<!--								if ($scope.patients.length === 0) {-->
<!--									$scope.message = 'No data found for the given search term.';-->
<!--								} else {-->
<!--									$scope.message = '';-->
<!--								}-->
<!--							})-->
<!--							.catch(function(rejection){-->
<!--								$scope.message = 'Unable to get the patient data.';-->
<!--								$scope.patients = [];-->
<!--							});-->
<!--				}-->
<!--			};-->

<!--			$scope.navigateToPatientDetail = function (patient) {-->
<!--				$http.get('/iTrust2/api/v1/emergency/patients/' + patient.username)// + '?patientName=' + patient.username)-->
<!--						.then(function (response) {-->
<!--							$scope.selectedPatient = response.data;-->
<!--							console.log(response.data);-->
<!--							return $http.get('/iTrust2/api/v1/emergency/patients/' + patient.username + '/recentDiagnoses');-->
<!--						})-->
<!--						.then(function (response) {-->
<!--							$scope.recentDiagnoses = response.data;-->
<!--							return $http.get('/iTrust2/api/v1/emergency/patients/' + patient.username + '/recentPrescriptions');-->
<!--						})-->
<!--						.then(function (response) {-->
<!--							$scope.recentPrescriptions = response.data;-->
<!--							$scope.showPatientDetails = true;-->
<!--						})-->
<!--						.catch(function (rejection) {-->
<!--							$scope.message = 'Unable to get detailed patient information.';-->
<!--						});-->
<!--			};-->

<!--			function filterPatients(data, searchTerm) {-->
<!--				return data.filter(function (patient) {-->
<!--					return patient.username.includes(searchTerm) || patient.patientname.includes(searchTerm);-->
<!--				});-->
<!--			}-->
<!--		});-->
<!--		//-->
<!--		// app.controller('PatientDetailController', function ($scope, $http) {-->
<!--		// 	$scope.selectedPatient = {};-->
<!--		// 	$scope.recentDiagnoses = [];-->
<!--		// 	$scope.recentPrescriptions = [];-->
<!--		//-->
<!--		// 	$http.get('/iTrust2/api/v1/emergency/patients/' + username)-->
<!--		// 			.then(function (response) {-->
<!--		// 				$scope.selectedPatient = response.data;-->
<!--		// 			})-->
<!--		// 			.catch(function (rejection) {-->
<!--		// 				$scope.message = 'Unable to get detailed patient information.';-->
<!--		// 			});-->
<!--		//-->
<!--		// 	$http.get('/api/v1/emergency/patients/' + username + '/recentDiagnoses')-->
<!--		// 			.then(function (response) {-->
<!--		// 				$scope.recentDiagnoses = response.data;-->
<!--		// 			})-->
<!--		// 			.catch(function (rejection) {-->
<!--		// 				$scope.message = 'Unable to get recent diagnoses.';-->
<!--		// 			});-->
<!--		//-->
<!--		// 	$http.get('/api/v1/emergency/patients/' + username + '/recentPrescriptions')-->
<!--		// 			.then(function (response) {-->
<!--		// 				$scope.recentPrescriptions = response.data;-->
<!--		// 			})-->
<!--		// 			.catch(function (rejection) {-->
<!--		// 				$scope.message = 'Unable to get recent prescriptions.';-->
<!--		// 			});-->
<!--		// });-->
<!--	</script>-->

<!--	<div ng-app="emergencyResponderApp" ng-controller="emergencyResponderController">-->
<!--		<h1>Welcome to iTrust2 - Emergency Responder</h1>-->

<!--		&lt;!&ndash; Search bar and button &ndash;&gt;-->
<!--		<form>-->
<!--			<input type="text" ng-model="searchTerm" placeholder="Enter your search term"/>-->
<!--			<button type="button" ng-click="search()">Search</button>-->
<!--		</form>-->

<!--		&lt;!&ndash; Page states &ndash;&gt;-->
<!--		<p style="color: black">{{message}}</p>-->

<!--		&lt;!&ndash; Table of Patients &ndash;&gt;-->
<!--		<table ng-if="patients.length > 0">-->
<!--			<tr>-->
<!--				<th>Username</th>-->
<!--				<th>Patient Name</th>-->
<!--				<th>Select</th>-->
<!--			</tr>-->
<!--			<tr ng-repeat="patient in patients">-->
<!--				<td>{{patient.username}}</td>-->
<!--				<td>{{patient.firstName + " " + patient.lastName}}</td>-->
<!--				<td>-->
<!--					<a ng-click="navigateToPatientDetail(patient)">-->
<!--						Select-->
<!--					</a>-->
<!--				</td>-->
<!--			</tr>-->
<!--		</table>-->

<!--		&lt;!&ndash; Patient Details &ndash;&gt;-->
<!--		<div ng-if="showPatientDetails">-->
<!--			<h2>{{selectedPatient.firstName}} {{selectedPatient.lastName}}</h2>-->
<!--			<p><strong>Username:</strong> {{selectedPatient.username}}</p>-->
<!--			<p><strong>Name:</strong>{{selectedPatient.firstName}} {{selectedPatient.lastName}}</p>-->
<!--			<p><strong>Age:</strong> {{calculateAge(selectedPatient.dateOfBirth)}}</p>-->
<!--			<p><strong>Date of birth:</strong>{{selectedPatient.dateOfBirth}}</p>-->
<!--			<p><strong>Gender:</strong>{{selectedPatient.gender}}</p>-->
<!--			<p><strong>Blood type:</strong> {{selectedPatient.bloodType}}</p>-->

<!--			&lt;!&ndash; Display Recent Diagnoses &ndash;&gt;-->
<!--			<div ng-if="recentDiagnoses.length > 0">-->
<!--				<h3>Recent Diagnoses</h3>-->
<!--				<ul>-->
<!--					<li ng-repeat="diagnosis in recentDiagnoses">{{diagnosis.id}}</li>-->
<!--				</ul>-->
<!--			</div>-->

<!--			&lt;!&ndash; Display Recent Prescriptions &ndash;&gt;-->
<!--			<div ng-if="recentPrescriptions.length > 0">-->
<!--				<h3>Recent Prescriptions</h3>-->
<!--				<ul>-->
<!--					<li ng-repeat="prescription in recentPrescriptions">{{prescription.id}}</li>-->
<!--				</ul>-->
<!--			</div>-->
<!--		</div>-->
<!--	</div>-->
<!--</div>-->
<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="layout :: head(title=~{::title}, links=~{})">
	<title>Emergency Responder Home</title>
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
</head>
<body th:include="layout :: body" th:with="content=~{::content}">
<div th:fragment="content">
	<script th:inline="javascript">
		var app = angular.module('emergencyResponderApp', []);

		app.controller('emergencyResponderController', function ($scope, $http, $window) {
			$scope.searchTerm = '';
			$scope.patients = [];
			$scope.message = 'Welcome';
			$scope.showPatientDetails = false;

			$scope.calculateAge = function (birthDate) {
				// Assuming birthDate is in the format 'yyyy-MM-dd'
				var birthYear = new Date(birthDate).getFullYear();
				var currentYear = new Date().getFullYear();
				return currentYear - birthYear;
			};

			$scope.search = function () {
				if (!$scope.searchTerm.trim()) {
					$scope.message = 'No data found. Please enter a search term.';
					$scope.patients = [];
				} else {
					$http.get('/iTrust2/api/v1/patientSearch', { params: { nameQuery: $scope.searchTerm } })
							.then(function (response) {
								$scope.patients = filterPatients(response.data, $scope.searchTerm);
								if ($scope.patients.length === 0) {
									$scope.message = 'No data found for the given search term.';
								} else {
									$scope.message = '';
								}
							})
							.catch(function(rejection){
								$scope.message = 'Unable to get the patient data.';
								$scope.patients = [];
							});
				}
			};

			$scope.navigateToPatientDetail = function (patient) {
				$window.location.href = '/patient_detail.html?username=' + patient.username;
			};

			function filterPatients(data, searchTerm) {
				return data.filter(function (patient) {
					return patient.username.includes(searchTerm) || patient.patientname.includes(searchTerm);
				});
			}
		});
	</script>

	<div ng-app="emergencyResponderApp" ng-controller="emergencyResponderController">
		<h1>Welcome to iTrust2 - Emergency Responder</h1>

		<!-- Search bar and button -->
		<form>
			<input type="text" ng-model="searchTerm" placeholder="Enter your search term"/>
			<button type="button" ng-click="search()">Search</button>
		</form>

		<!-- Page states -->
		<p style="color: black">{{message}}</p>

		<!-- Table of Patients -->
		<table ng-if="patients.length > 0">
			<tr>
				<th>Username</th>
				<th>Patient Name</th>
				<th>Select</th>
			</tr>
			<tr ng-repeat="patient in patients">
				<td>{{patient.username}}</td>
				<td>{{patient.firstName + " " + patient.lastName}}</td>
				<td>
					<a ng-click="navigateToPatientDetail(patient)">
						Select
					</a>
				</td>
			</tr>
		</table>

		<!-- Patient Details -->
		<div ng-if="showPatientDetails">
			<!-- Details will be displayed on patient_detail.html page -->
		</div>
	</div>
</div>
</body>
</html>
